## 一 大纲
  
  1. 性能指标与测量上报
  2. 前端优化链路
  3. 离线化方案简介
  

### 1. 性能指标与测量上报


> 性能指标

 * Web Vitals是谷歌针对网页加载速度和体验所提出的一套指标,Web Vitals中希望所有人都能够引起重视的三个指标

  1. LCP（Largest Contentful Paint），即最大内容渲染，指的是视窗（viewport）内所有可见元素中尺寸最大的文本块或图像所需的渲染时间；
     与之相近的一个指标是FCP（First Contentful Paint），该指标是用于检测第一个文本块或者图像渲染完成的时间，侧重点不同
     
     指标作用

     这个指标主要是用来弄清用户所看到的页面主体内容何时被渲染出来，之前也有相应的指标用于相似的目的，但是实际上存在很多的不足：

     load和DOMContentLoaded事件只是反应了代码层面的加载时间结点，而非真实用户所关注的屏幕页面渲染效果，因此很不准确；
     而FCP指标也只是关注了最初始的渲染效果，和用户关心的页面整体效果也相差甚远；
     后面提出用于关注初始渲染状态之后的加载效果的指标——FMP（First Meaningful Paint）和SI（Speed Index），经实践证明效果不太行，经常出错，而且这两个指标计算很复杂也很难去解释；

  2. CLS（Cumulative Layout Shift），即累积布局偏移，指的是首屏页面渲染过程中所有元素结点相对原始位置所发生的位置偏移累积量；

   指标作用

    该指标主要是为了量化渲染过程中的视觉稳定性（visual stability）；因为渲染过程或者交互过程中发生的非用户期待的视觉改变行为会影响用户的使用满意度，而布局偏移就是其中一种很常见的现象，经常出现在：

    img/video等媒体元素未指定尺寸，当资源加载完成后渲染尺寸发生改变，通常表现为突然地闪变，以及影响周围元素的位置变化
插入一些DOM结点，导致用户原本关注的区域突然偏移

3. TTFB（Time to First Byte）：用户浏览器从开始加载网页内容到接收到第一个字节的网页内容之间的耗时，该指标主要侧重于网页加载体验；
4. FCP（First Contentful Paint）：从开始加载网页内容到第一个文本块或者图像渲染完成之间的耗时，该指标主要侧重于网页加载体验；
5. TTI（Time to Interactive）
6. FID（First Input Delay），即第一次输入事件延迟，指的是用户第一次交互事件触发到主线程接收事件然后反应之间的时间；

指标作用

这个指标主要是从交互响应层面来量化用户对页面的第一印象；

因为新用户对一个网页的第一印象好坏对用户忠诚度影响很大，而第一印象除了网页的加载速度，还与第一次交互时的响应速度有着很大的关系；

这里的延迟指的就是用户交互触发的事件到主线程接收事件之间的延迟，也就是用于判断对于第一次交互时主线程的阻塞程度，延迟越低说明主线程比较空闲，也就利于用户对页面的交互响应速度；

至于为何只关注事件之间的延迟时间，而不是延迟时间 + 事件执行耗时 + UI状态更新耗时的方式，官方给出的解释是：
7. TBT（Total Blocking Time）：FCP到TTI之间阻塞主线程的总耗时，所谓的阻塞就是长任务，而单个长任务的阻塞时间就是任务耗时 - 50ms；该指标主要侧重于网页加载体验，用于量化主线程阻塞的严重程度；
 * 

![h5_2](https://user-images.githubusercontent.com/31762176/202593434-e5167c82-a57d-4470-9077-3e16142e95a1.png)

![h5](https://user-images.githubusercontent.com/31762176/202593176-00581706-ebf7-4dab-9bd4-bedcbb7cc5d5.png)

> 性能检测

上面就是几种常用的Web Vitals指标分析工具，其中比较推荐的是PageSpeed Insights和chrome浏览器内置的Lighthouse，因为这两个工具打开即可使用，而且没有代码侵入性，并且会有相应指标的改进建议；
但是Lighthouse没有FID指标的分析，不过可以使用相近的TBT进行替代；
webpagetest.org




> 测量上报


